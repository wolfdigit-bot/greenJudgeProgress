<html>
<head>
<title>list grabber</title>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" crossorigin="anonymous"></script>
<script src="storage-gist.js"></script>
</head>
<body style="height:100%">
  <div id="input" class="container-fluid" style="padding: 100px;">
    <div class="row">
        <div class="col-xs-8 col-xs-offset-2">
            <form class="form-inline" target="_self" onsubmit="javascript:setLid();return false;">
                <div class="form-group">
                    <label for="uname">list id:</label>
                    <input type="text" class="form-control" id="uname" name="uname" placeholder="info17">
                    <label for="pw">pass phrase:</label>
                    <input type="text" class="form-control" id="pw" name="pw" placeholder="TBA.">
                </div>
                <button type="submit" class="btn btn-default">Go</button>
            </form>
        </div>
    </div>
    <script>
    function setLid() {
      uname = document.getElementById("uname").value;
      window.location.href = "#"+uname;
      window.location.reload();
    }
    </script>
  </div>

  <div id="main" style="display: none; position:relative; height:100%">
    <div id="list" style="display:block; position:absolute; height:100%; width:20%; left:0"></div>
    <div id="ifrm" style="display:block; position:absolute; height:100%; width:75%; left:20%">
      <iframe name="ifrm" style="width:100%; height:100%"></iframe>
    </div>
  </div>
  
  <script>
    function showGjList(list) {
      list.forEach(function(uname) {
        elem = $('<a>').attr("href", 'grabber.html#'+uname).attr('target', 'ifrm').text(uname);
        elem.click(function(e) {
          $("#ifrm > iframe").attr('src', '');
          $("#ifrm > iframe").attr('src', 'grabber.html#'+uname);
        });
        elem = $('<p>').append(elem);
        $("#list").append(elem);
      });
    }
    
    gjList = [];
    function main(lid) {
      getFile("list-"+lid, function(obj) {
        //console.log(obj);
        obj = JSON.parse(obj);
        //console.log(obj['user']);
        //$("#list").text(obj);
        obj['user'].forEach(function(user) {
          //console.log(user);
          //$("#list").append(JSON.stringify(user));
          gjList.push(user['gj']);
        });
        //$("#list").append(JSON.stringify(gjList));
        //console.log(gjList);
        showGjList(gjList);
      });
    }

    lid = window.location.hash.substring(1);
    if (lid.length>0) {
      main(lid);
      $("#input").hide();
      $("#main").show();
    }
  </script>
</body>
</html>